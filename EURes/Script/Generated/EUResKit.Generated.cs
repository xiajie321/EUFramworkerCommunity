// 自动生成的代码，请勿手动修改
// Generated by EUResKit Template Generator

using Cysharp.Threading.Tasks;
using YooAsset;
using UnityEngine;

namespace EUFramework.Extension.EURes
{
    /// <summary>
    /// 资源管理工具类 - 自动生成
    /// </summary>
    public static partial class EUResKit
    {
        #region 私有字段
        
        private static string _defaultPackageName;
        
        #endregion
        
        #region 包初始化
        
        /// <summary>
        /// 初始化资源包
        /// </summary>
        /// <param name="packageName">资源包名称</param>
        /// <param name="playMode">运行模式</param>
        /// <returns>初始化是否成功</returns>
        public static async UniTask<bool> InitPackageResAsync(string packageName, EPlayMode playMode)
        {
            // 检查包是否已初始化
            var existingPackage = YooAssets.TryGetPackage(packageName);
            if (existingPackage != null)
            {
                return true;
            }

            // 执行热更新初始化流程
            var patchOperation = new EUResKitPatchOperation(packageName, playMode);
            
            // 配置用户交互回调
            SetupPatchOperationCallbacks(patchOperation, packageName);
            
            await patchOperation;

            if (patchOperation.Status == EOperationStatus.Succeed)
            {
                return true;
            }
            else
            {
                Debug.LogError($"[EUResKit] Package '{packageName}' initialization failed! Error: {patchOperation.Error}");
                return false;
            }
        }
        
        #endregion
        
        #region 包管理
        
        /// <summary>
        /// 获取资源包
        /// </summary>
        /// <param name="packageName">资源包名称，为空则返回默认包</param>
        /// <returns>资源包实例</returns>
        public static ResourcePackage GetPackage(string packageName = null)
        {
            // 如果未指定包名，返回默认包
            if (string.IsNullOrEmpty(packageName))
            {
                if (string.IsNullOrEmpty(_defaultPackageName))
                {
                    Debug.LogError($"[EUResKit] Default package is not set!");
                    return null;
                }
                packageName = _defaultPackageName;
            }

            // 直接从 YooAssets 获取包
            var package = YooAssets.TryGetPackage(packageName);
            if (package == null)
            {
                Debug.LogError($"[EUResKit] Package '{packageName}' not found! Please call InitPackageResAsync first.");
            }
            
            return package;
        }

        /// <summary>
        /// 设置默认资源包
        /// </summary>
        /// <param name="packageName">资源包名称</param>
        public static void SetDefaultPackage(string packageName)
        {
            var package = YooAssets.TryGetPackage(packageName);
            if (package != null)
            {
                _defaultPackageName = packageName;
                YooAssets.SetDefaultPackage(package);
            }
            else
            {
                Debug.LogError($"[EUResKit] Package '{packageName}' not found!");
            }
        }

        /// <summary>
        /// 检查资源包是否已初始化
        /// </summary>
        /// <param name="packageName">资源包名称，为空则检查默认包</param>
        public static bool IsInitialized(string packageName = null)
        {
            if (string.IsNullOrEmpty(packageName))
            {
                packageName = _defaultPackageName;
            }
            
            if (string.IsNullOrEmpty(packageName))
            {
                return false;
            }
            
            return YooAssets.TryGetPackage(packageName) != null;
        }
        
        #endregion
    }
}